<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Submit ‚Äì Eindcode invoeren</title>
  <script type="module" src="./js/firebase.js"></script>
  <link rel="stylesheet" href="./css/style.css">
</head>
<body>
  <main>
    <h1>üèÅ Finale ‚Äì Voer de eindcode in</h1>
    <p>Heb je alle 5 codes verzameld? Vul dan de volledige eindcode hieronder in om je tijd te registreren.</p>

    <input type="text" id="finalCode" placeholder="Bijv. 64214">
    <button onclick="submitCode()">Indienen</button>
    <p id="status"></p>
  </main>

  <script type="module">
    import { saveScore } from './js/firebase.js';

    function getCombinedCode() {
      return (
        localStorage.getItem("ctfCode1") +
        localStorage.getItem("ctfCode2") +
        localStorage.getItem("ctfCode3") +
        localStorage.getItem("ctfCode4") +
        localStorage.getItem("ctfCode5")
      );
    }

    window.submitCode = async function () {
      const entered = document.getElementById("finalCode").value.trim();
      const expected = getCombinedCode(); // bv. '64214'

      const name = localStorage.getItem("ctfPlayer") || "Anoniem";
      const startTime = parseInt(localStorage.getItem("ctfStartTime"));
      const endTime = Date.now();
      const totalTime = ((endTime - startTime) / 1000).toFixed(2);

      if (entered === expected) {
        document.getElementById("status").textContent = `‚úÖ Correct! Je tijd: ${totalTime}s`;

        try {
          await saveScore(name, Number(totalTime));
          setTimeout(() => {
            window.location.href = "scoreboard.html";
          }, 2000);
        } catch (e) {
          console.error("Fout bij opslaan score:", e);
          document.getElementById("status").textContent = "‚ö†Ô∏è Kon score niet opslaan. Probeer opnieuw.";
        }

      } else {
        document.getElementById("status").textContent = "‚ùå Foute code. Controleer je opdrachten nog eens.";
      }
    };
  </script>
</body>
</html>
